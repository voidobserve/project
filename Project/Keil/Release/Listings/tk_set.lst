C51 COMPILER V9.60.7.0   TK_SET                                                            08/08/2024 17:07:42 PAGE 1   


C51 COMPILER V9.60.7.0, COMPILATION OF MODULE TK_SET
OBJECT MODULE PLACED IN .\Release\Objects\tk_set.obj
COMPILER INVOKED BY: C:\Keil_v5\C51\BIN\C51.EXE ..\..\User\lib\tk_set.c LARGE OPTIMIZE(8,SIZE) BROWSE INTVECTOR(0X000C) 
                    -INCDIR(..\..\Libraries\Include;..\..\User;..\..\User\lib;..\..\Hardware;..\..\Lowpower;..\..\App) INTERVAL(3) DEBUG OBJE
                    -CTEXTEND PRINT(.\Release\Listings\tk_set.lst) OBJECT(.\Release\Objects\tk_set.obj)

line level    source

   1          // encoding GB2312
   2          /**
   3           ******************************************************************************
   4           * @file    User/tk_lib.c
   5           * @author  HUGE-IC Application Team
   6           * @version V1.0.0
   7           * @date    05-20-2022
   8           * @brief   Main program body
   9           ******************************************************************************
  10           * @attention
  11           * tk_set.cÎÄ¼þÊÇÏµÍ³Ê¹ÓÃµÄÎÄ¼þ£¬²»½¨ÒéÐÞ¸Ä¡£
  12           * ÒÔÏÂº¯ÊýºÍ±äÁ¿ÓÃ»§²»ÐèÒªÐÞ¸Ä
  13           *
  14           *
  15           *
  16           ******************************************************************************
  17           */
  18          
  19          /* Includes ------------------------------------------------------------------*/
  20          #include "include.h"
  21          #include "my_config.h"
  22          
  23          /** @addtogroup Template_Project
  24           * @{
  25           */
  26          
  27          /* Private typedef -----------------------------------------------------------*/
  28          /* Private define ------------------------------------------------------------*/
  29          /* Private macro -------------------------------------------------------------*/
  30          /* Private variables ---------------------------------------------------------*/
  31          /* Private function prototypes -----------------------------------------------*/
  32          /* Private functions ---------------------------------------------------------*/
  33          /**
  34           * @}
  35           */
  36          // ÅäÖÃÒ»¸ö10msµÄÖÐ¶Ï
  37          #define PEROID_VAL (SYSCLK / 128 / 100 - 1)
  38          // ÓÃ»§²»ÔÊÐíÐÞ¸Ä
  39          volatile unsigned short xdata __tk_ch_data_0[TK_CH_USE] _at_(0x6000 + 0);
  40          volatile unsigned short xdata __tk_ch_data_1[TK_CH_USE] _at_(0x6000 + TK_CH_USE * 2);
  41          volatile unsigned short xdata __tk_ch_data_2[TK_CH_USE] _at_(0x6000 + TK_CH_USE * 4);
  42          volatile unsigned short xdata __tk_ch_data_3[TK_CH_USE] _at_(0x6000 + TK_CH_USE * 8);
  43          volatile unsigned short xdata __tk_ch_data_4[TK_CH_USE] _at_(0x6000 + TK_CH_USE * 10);
  44          volatile unsigned short xdata __tk_ch_data_5[TK_CH_USE];
  45          volatile unsigned short xdata __tk_ch_data_6[TK_CH_USE];
  46          volatile unsigned short xdata __tk_ch_fth[TK_CH_USE];
  47          volatile unsigned short xdata __tk_i_set[TK_CH_USE];
  48          volatile unsigned char xdata __tk_update_cnt[TK_CH_USE];
  49          volatile unsigned char xdata __tk_confirm_cnt[TK_CH_USE];
  50          volatile unsigned char xdata __tk_leave_cnt[TK_CH_USE];
  51          volatile unsigned char xdata __tk_ch_index[TK_CH_USE];
  52          
  53          // ÓÃ»§²»ÔÊÐíÐÞ¸Ä
C51 COMPILER V9.60.7.0   TK_SET                                                            08/08/2024 17:07:42 PAGE 2   

  54          unsigned long code __tk_adjust_line = TK_DATA_LINE;
  55          unsigned short code __tk_adjust_time = TK_ADJUST_TIME;
  56          unsigned short code __tk_adjust_diff_valu = TK_MAX_DIFF_VALU;
  57          unsigned char code __tk_adjust_en = TK_ADJUST_EN;
  58          
  59          unsigned short code __tk_valid_time = TK_VALID_TIME;
  60          unsigned short code __tk_long_key_time = TK_LONG_KEY_TIME;
  61          unsigned short code __tk_noise_value = TK_NOISE_VAL;
  62          unsigned char code __tk_cs_en = TK_CS_EN;
  63          unsigned char code __tk_tp_en = TK_TP_EN;
  64          unsigned char code __tk_nm_num = TK_MU_CNT;
  65          unsigned char code __tk_base_update_cnt = TK_UPDATE_CNT;
  66          unsigned char code __tk_nm_cm_value = TK_NM_CM_CNT;
  67          unsigned char code __tk_cm_valu = TK_CM_VALE;
  68          unsigned char code __tk_use_num = TK_CH_USE;
  69          
  70          /*
  71          **´¥ÃþÍ¨µÀÐÅÏ¢±í
  72          */
  73          static u16 code TK_CH_EN_BUG[][2] =
  74              {
  75          #if TK0_CH_EN
  76                  {
  77                      0u,           // Í¨µÀÖµ
  78                      TK0_THR_DATA, // ÃÅÏÞÖµ
  79                  },
  80          #endif
  81          
  82          #if TK1_CH_EN
                      {
                          1u,
                          TK1_THR_DATA,
                      },
              #endif
  88          
  89          #if TK2_CH_EN
  90                  {
  91                      2u,
  92                      TK2_THR_DATA,
  93                  },
  94          #endif
  95          
  96          #if TK3_CH_EN
  97                  {
  98                      3u,
  99                      TK3_THR_DATA,
 100                  },
 101          #endif
 102          
 103          #if TK4_CH_EN
                      {
                          4u,
                          TK4_THR_DATA,
                      },
              #endif
 109          
 110          #if TK5_CH_EN
                      {
                          5u,
                          TK5_THR_DATA,
                      },
              #endif
C51 COMPILER V9.60.7.0   TK_SET                                                            08/08/2024 17:07:42 PAGE 3   

 116          
 117          #if TK6_CH_EN
                      {
                          6u,
                          TK6_THR_DATA,
                      },
              #endif
 123          
 124          #if TK7_CH_EN
                      {
                          7u,
                          TK7_THR_DATA,
                      },
              #endif
 130          
 131          #if TK8_CH_EN
                      {
                          8u,
                          TK8_THR_DATA,
                      },
              #endif
 137          
 138          #if TK9_CH_EN
 139                  {
 140                      9u,
 141                      TK9_THR_DATA,
 142                  },
 143          #endif
 144          
 145          #if TK10_CH_EN
 146                  {
 147                      10u,
 148                      TK10_THR_DATA,
 149                  },
 150          #endif
 151          
 152          #if TK11_CH_EN
 153                  {
 154                      11u,
 155                      TK11_THR_DATA,
 156                  },
 157          #endif
 158          
 159          #if TK12_CH_EN
                      {
                          12u,
                          TK12_THR_DATA,
                      },
              #endif
 165          
 166          #if TK13_CH_EN
                      {
                          13u,
                          TK13_THR_DATA,
                      },
              #endif
 172          
 173          #if TK14_CH_EN
                      {
                          14u,
                          TK14_THR_DATA,
                      },
C51 COMPILER V9.60.7.0   TK_SET                                                            08/08/2024 17:07:42 PAGE 4   

              #endif
 179          
 180          #if TK15_CH_EN
                      {
                          15u,
                          TK15_THR_DATA,
                      },
              #endif
 186          
 187          #if TK16_CH_EN
                      {
                          16u,
                          TK16_THR_DATA,
                      },
              #endif
 193          
 194          #if TK17_CH_EN
                      {
                          17u,
                          TK17_THR_DATA,
                      },
              #endif
 200          
 201          #if TK18_CH_EN
                      {
                          18u,
                          TK18_THR_DATA,
                      },
              #endif
 207          
 208          #if TK19_CH_EN
                      {
                          19u,
                          TK19_THR_DATA,
                      },
              #endif
 214          
 215          #if TK20_CH_EN
                      {
                          20u,
                          TK20_THR_DATA,
                      },
              #endif
 221          
 222          #if TK21_CH_EN
                      {
                          21u,
                          TK21_THR_DATA,
                      },
              #endif
 228          
 229          #if TK22_CH_EN
                      {
                          22u,
                          TK22_THR_DATA,
                      },
              #endif
 235          
 236          #if TK23_CH_EN
                      {
                          23u,
                          TK23_THR_DATA,
C51 COMPILER V9.60.7.0   TK_SET                                                            08/08/2024 17:07:42 PAGE 5   

                      },
              #endif
 242          
 243          #if TK24_CH_EN
                      {
                          24u,
                          TK24_THR_DATA,
                      },
              #endif
 249          
 250          #if TK25_CH_EN
                      {
                          25u,
                          TK25_THR_DATA,
                      },
              #endif
 256          };
 257          
 258          /**
 259           * @brief  Touchkey gpio init function
 260           * @param  None
 261           * @retval None
 262           */
 263          void tk_gpio_config(void)
 264          {
 265   1          u8 i = 0;
 266   1      
 267   1          for (i = 0; i < TK_CH_USE; i++)
 268   1          {
 269   2      
 270   2              if (__tk_ch_index[i] < 8)
 271   2              {
 272   3                  if (__tk_ch_index[i] < 4)
 273   3                  {
 274   4                      P0_MD0 &= ~(0x3 << (__tk_ch_index[i] - 0) * 2);
 275   4                      P0_MD0 |= (0x3 << (__tk_ch_index[i] - 0) * 2);
 276   4                  }
 277   3                  else
 278   3                  {
 279   4                      P0_MD1 &= ~(0x3 << (__tk_ch_index[i] - 4) * 2);
 280   4                      P0_MD1 |= (0x3 << (__tk_ch_index[i] - 4) * 2);
 281   4                  }
 282   3              }
 283   2              else if ((__tk_ch_index[i] >= 8) && (__tk_ch_index[i] < 16))
 284   2              {
 285   3                  if (__tk_ch_index[i] < 12)
 286   3                  {
 287   4                      P1_MD0 &= ~(0x3 << (__tk_ch_index[i] - 8) * 2);
 288   4                      P1_MD0 |= (0x3 << (__tk_ch_index[i] - 8) * 2);
 289   4                  }
 290   3                  else
 291   3                  {
 292   4                      P1_MD1 &= ~(0x3 << (__tk_ch_index[i] - 12) * 2);
 293   4                      P1_MD1 |= (0x3 << (__tk_ch_index[i] - 12) * 2);
 294   4                  }
 295   3              }
 296   2              else
 297   2              {
 298   3                  if (__tk_ch_index[i] < 20)
 299   3                  {
 300   4                      P2_MD0 &= ~(0x3 << (__tk_ch_index[i] - 16) * 2);
 301   4                      P2_MD0 |= (0x3 << (__tk_ch_index[i] - 16) * 2);
C51 COMPILER V9.60.7.0   TK_SET                                                            08/08/2024 17:07:42 PAGE 6   

 302   4                  }
 303   3                  else
 304   3                  {
 305   4                      P2_MD1 &= ~(0x3 << (__tk_ch_index[i] - 20) * 2);
 306   4                      P2_MD1 |= (0x3 << (__tk_ch_index[i] - 20) * 2);
 307   4                  }
 308   3              }
 309   2          }
 310   1      }
 311          
 312          /**
 313           * @brief  Touchkey_IRQHandler
 314           * @param  none
 315           * @retval None
 316           */
 317          void TK_IRQHandler(void) interrupt TK_IRQn
 318          {
 319   1          __IRQnIPnPush(TK_IRQn);
 320   1          if (TK_CON2 & (0x1 << 6))
 321   1          {
 322   2              TK_CON2 |= (0x1 << 6);
 323   2              __tk_handler();
 324   2          }
 325   1          __IRQnIPnPop(TK_IRQn);
 326   1      }
 327          
 328          /**
 329           * @brief  Touchkey Module init function
 330           * @param  None
 331           * @retval None
 332           */
 333          void tk_init(void)
 334          {
 335   1          IE_EA = 1;
 336   1          IE3 |= (0x1 << 3);
 337   1          IP6 |= (0x3 << 6);
 338   1          CLK_CON2 |= (0x1 << 6);
 339   1          __EnableIRQ(TK_IRQn);
 340   1          TK_ACON0 = 0x3F;
 341   1          TK_ACON1 = 0x4B;
 342   1          TK_ACON3 = 0x30;
 343   1          TK_PSRCNT = 0x2F;
 344   1          TK_APRECHARGE = 0x4f;
 345   1          TK_APREDISCH = 0x27;
 346   1          TK_ACONVTIME = 0xA8;
 347   1          TK_BASEDIV0 = 0x10;
 348   1          TK_BASEDIV1 = 0x0;
 349   1          TK_BASEDIV2 = 0x0;
 350   1          TK_BASEDIV3 = 0x0;
 351   1          TK_CHCON3 = 0xD0;
 352   1          TK_CON0 = 0x4;
 353   1          TK_CON1 = 0x1E;
 354   1          TK_CON2 = 0x02;
 355   1      }
 356          
 357          /**
 358           * @brief  TIMR0_IRQHandler function
 359           * @param  None
 360           * @retval None
 361           */
 362          void WUT_IRQHandler(void) interrupt WUT_IRQn
 363          {
C51 COMPILER V9.60.7.0   TK_SET                                                            08/08/2024 17:07:42 PAGE 7   

 364   1          // ½øÈëÖÐ¶ÏÉèÖÃIP£¬²»¿ÉÉ¾³ý
 365   1          __IRQnIPnPush(WUT_IRQn);
 366   1          // ÖÜÆÚÖÐ¶Ï
 367   1          if (WUT_CONH & TMR_PRD_PND(0x1))
 368   1          {
 369   2              WUT_CONH |= TMR_PRD_PND(0x1); // Çå³ýpending
 370   2              __tk_ms_handler();            // ±ÕÔ´µÄ£¬²»ÖªµÀ×öÁËÊ²Ã´£¬¿´ÉÏÈ¥ÊÇÈÃCPU½øÈëË¯Ãß£¬µ¥Î»Îªms£¨ÊÖ²áÉÏËµ
             -ÊÇË¯Ãß300ms£©
 371   2          }
 372   1      
 373   1          // ÍË³öÖÐ¶ÏÉèÖÃIP£¬²»¿ÉÉ¾³ý
 374   1          __IRQnIPnPop(WUT_IRQn);
 375   1      }
 376          
 377          #if 0
              /**
               * @brief  TIMER Module init function
               * @param  None
               * @retval None
               */
              void wut_init(void)
              {
                  __EnableIRQ(WUT_IRQn);
                  IE_EA = 1;
              
                  // ÉèÖÃtimer2µÄ¼ÆÊý¹¦ÄÜ£¬ÅäÖÃÒ»¸ö10msµÄÖÐ¶Ï
                  TMR_ALLCON = WUT_CNT_CLR(0x1);
                  WUT_PRH = TMR_PERIOD_VAL_H((PEROID_VAL >> 8) & 0xFF);                       // timer2¼ÆÊýÖÜÆÚ¸ß8Î»
                  WUT_PRL = TMR_PERIOD_VAL_L((PEROID_VAL >> 0) & 0xFF);                       // timer2¼ÆÊýÖÜÆÚµÍ8Î»
                  WUT_CONH = TMR_PRD_PND(0x1) | TMR_PRD_IRQ_EN(0x1);                          // Çå³ýÖÐ¶Ï±êÖ¾Î»²¢Ê¹ÄÜÖÐ¶
             -Ï
                  WUT_CONL = TMR_SOURCE_SEL(0x7) | TMR_PRESCALE_SEL(0x7) | TMR_MODE_SEL(0x1); // ÅäÖÃtimer2Ê±ÖÓÔ´¡¢Ô¤·ÖÆ
             -µÖµ¡¢Ä£Ê½
              }
              #endif // end void wut_init(void)
 396          
 397          /**
 398           * @brief  Touchkey  parameter configuration function
 399           *         °´¼ü²ÎÊýÅäÖÃº¯Êý
 400           *
 401           * @param  None
 402           * @retval None
 403           */
 404          void tk_param_init(void)
 405          {
 406   1          u8 i = 0;
 407   1      
 408   1          /* °´¼üÍ¨µÀ¡¢µçÁ÷¡¢ÁéÃô¶È³õÊ¼»¯ */
 409   1          for (i = 0; i < TK_CH_USE; i++)
 410   1          {
 411   2              __tk_ch_index[i] = (u8)(TK_CH_EN_BUG[i][0] & 0xff); // ´æ·Å°´¼üÍ¨µÀÐÅÏ¢
 412   2              __tk_ch_fth[i] = TK_CH_EN_BUG[i][1];                // ´æ·Å°´¼üÍ¨µÀÐÅÏ¢
 413   2              __tk_i_set[i] = TK_CURR_GEAR;                       // ³äµçµçÁ÷
 414   2              __tk_ch_en |= (1UL << __tk_ch_index[i]);            // °´¼üÍ¨µÀÊ¹ÄÜ
 415   2          }
 416   1      
 417   1          /* °´¼üIOÅäÖÃº¯Êý */
 418   1          tk_gpio_config();
 419   1      
 420   1          /* ¿âº¯Êý³õÊ¼»¯ */
 421   1          __tk_lib_init(); // µ÷ÓÃÁË¿â£¨±ÕÔ´£©
 422   1      
C51 COMPILER V9.60.7.0   TK_SET                                                            08/08/2024 17:07:42 PAGE 8   

 423   1          /* °´¼üÄ£¿éÅäÖÃº¯Êý */
 424   1          tk_init();
 425   1      
 426   1          /* ¶¨Ê±Æ÷ÅäÖÃº¯Êý */
 427   1          // wut_init();
 428   1      }
 429          
 430          /**
 431           * @brief  Touchkey  Circular execution function
 432           * @param  None
 433           * @retval None
 434           */
 435          void tk_handle(void)
 436          {
 437   1          /* ÓÃ»§´úÂë³õÊ¼»¯½Ó¿Ú */
 438   1          user_init();
 439   1      
 440   1          /* °´¼ü³õÊ¼»¯ */
 441   1          tk_param_init();
 442   1      
 443   1          check_light_ctl_mode();   // ÉÏµçºóÏÈ¼ì²âÒªÊ¹ÓÃÄÄÖÖµÆ¹â¿ØÖÆÄ£Ê½£¬×îºó£¬»áÅäÖÃÇý¶¯»ÆµÆµÄPWM
 444   1          white_light_pwm_config(); // ÅäÖÃÇý¶¯°×µÆµÄPWM
 445   1      
 446   1      #if USE_MY_DEBUG
                  // light_ctl_mode = LIGHT_CTL_MODE_MUILTY; // ½ÓÏÂÀ´´¥Ãþ°´¼ü²»½ö¿ÉÒÔ¿ØÖÆ¿ª¹ØµÆ£¬»¹¿ÉÒÔ¿ØÖÆÈýÖÖÑÕÉ«µÆ¹â
             -µÄÇÐ»»£¨light_ctl_mode = 0£©
                  light_ctl_mode = LIGHT_CTL_MODE_SINGLE;
              #endif // USE_MY_DEBUG
 450   1      
 451   1          // light_ctl_mode = LIGHT_CTL_MODE_SINGLE; // ²âÊÔÓÃ
 452   1          // light_ctl_mode = LIGHT_CTL_MODE_MUILTY; // ²âÊÔÓÃ
 453   1          // light_control_flag = LIGHT_WHITE_CLOSE;
 454   1      
 455   1          if (LIGHT_CTL_MODE_SINGLE == light_ctl_mode)
 456   1          {
 457   2              tmr2_enable(); // µ¥É«µ÷¹âÄ£Ê½ÏÂ£¬²ÅÊ¹ÓÃ¶¨Ê±Æ÷2À´ÊµÏÖ¿ª¹ØµÆµÄÁÁ¶È½¥±ä
 458   2          }
 459   1      
 460   1          /* ÏµÍ³Ö÷Ñ­»· */
 461   1          while (1)
 462   1          {
 463   2              /* °´¼üÉ¨Ãèº¯Êý */
 464   2              __tk_scan(); // Ê¹ÓÃÁË¿âÀïÃæµÄ½Ó¿Ú£¨±ÕÔ´¿â£©
 465   2      
 466   2              /* ÓÃ»§Ñ­»·É¨Ãèº¯Êý½Ó¿Ú */
 467   2              user_handle();
 468   2      
 469   2              knob_handle();
 470   2      
 471   2      #if 1
 472   2              if (is_touch_key_light_press) // Èç¹û°´¼ü--µÆ¹â°´ÏÂ£¨µ¥»÷£©
 473   2              {
 474   3                  is_touch_key_light_press = 0;
 475   3      
 476   3                  // Èç¹ûÊÇµ¥É«Ä£Ê½£¬Ö»¿ØÖÆ°×µÆ
 477   3                  if (LIGHT_CTL_MODE_SINGLE == light_ctl_mode)
 478   3                  {
 479   4                      if (light_on_off_status)
 480   4                      {
 481   5                          // Èç¹ûµÆ¹âÒÑ¾­¿ªÆô
 482   5                          // |-->¹ØµÆ
 483   5                          light_control_flag = LIGHT_WHITE_CLOSE;
C51 COMPILER V9.60.7.0   TK_SET                                                            08/08/2024 17:07:42 PAGE 9   

 484   5      
 485   5      #if USE_MY_DEBUG
                                  P24 = ~P24;
              #endif // #if USE_MY_DEBUG
 488   5      
 489   5                          light_on_off_status = 0; // ¸üÐÂµÆµÄ×´Ì¬
 490   5                          send_key_status(0x00);   // ·¢ËÍ²»´ø°´¼üÐÅÏ¢µÄÊý¾Ý£¬Ö÷ÒªÊÇ·¢ËÍµ±Ç°µÄµÆ¹â×´Ì¬
 491   5      
 492   5                          // ÏÂ´Î³¤°´Òª±ä³ÉÔö´óÁÁ¶È
 493   5                          light_adjust_add_sub_flag = 1; // ¸üÐÂÓÃÓÚ¿ØÖÆµ÷ÕûµÆ¹âÁÁ¶ÈµÄ±êÖ¾Î»
 494   5                      }
 495   4                      else
 496   4                      {
 497   5                          // Èç¹ûµÆ¹âÒÑ¾­¹Ø±Õ
 498   5                          // |-->¿ªµÆ
 499   5                          light_control_flag = LIGHT_WHITE_OPEN;
 500   5      
 501   5      #if USE_MY_DEBUG
                                  P24 = ~P24;
              #endif // #if USE_MY_DEBUG
 504   5      
 505   5                          light_on_off_status = 1; // ¸üÐÂµÆµÄ×´Ì¬
 506   5                          send_key_status(0x00);   // ·¢ËÍ²»´ø°´¼üÐÅÏ¢µÄÊý¾Ý£¬Ö÷ÒªÊÇ·¢ËÍµ±Ç°µÄµÆ¹â×´Ì¬
 507   5      
 508   5                          if (cur_white_duty == PWM_MIN_DUTY_LIGHT)
 509   5                          {
 510   6                              // ÏÂ´Î³¤°´Òª±ä³ÉÔö´óÁÁ¶È
 511   6                              light_adjust_add_sub_flag = 1; // ¸üÐÂÓÃÓÚ¿ØÖÆµ÷ÕûµÆ¹âÁÁ¶ÈµÄ±êÖ¾Î»
 512   6                          }
 513   5                          else
 514   5                          {
 515   6                              // ÏÂ´Î³¤°´Òª±ä³É¼õÐ¡ÁÁ¶È
 516   6                              light_adjust_add_sub_flag = 0; // ¸üÐÂÓÃÓÚ¿ØÖÆµ÷ÕûµÆ¹âÁÁ¶ÈµÄ±êÖ¾Î»
 517   6                          }
 518   5                      }
 519   4                  }
 520   3                  else // Èç¹ûÊÇÈýÉ«ÇÐ»»Ä£Ê½£¬Ã¿´Î´¥Ãþµ½°´¼ü£¬ÔÚ°×->»Æ->»Æ°×->¹Ø±Õ->°×ÖÐÑ­»·ÇÐ»»
 521   3                  {
 522   4                      if (LIGHT_MUILTY_CUR_OFF == light_muilty_cur_status) // °×µÆ£¨´Ó¹ØµÆµÄ×´Ì¬->°×µÆ£©
 523   4                      {
 524   5                          cur_pwm_duty = cur_white_duty;
 525   5                          tmr1_set_pwm_duty(cur_pwm_duty); // °×µÆ
 526   5                          white_light_open();              // ÖØÐÂÅäÖÃIOºÍ¶¨Ê±Æ÷
 527   5      
 528   5                          light_muilty_cur_status = LIGHT_MUILTY_CUR_WHITE;
 529   5                          light_on_off_status = 1; // ¸üÐÂµÆµÄ×´Ì¬
 530   5                          send_key_status(0x00);   // ·¢ËÍ²»´ø°´¼üÐÅÏ¢µÄÊý¾Ý£¬Ö÷ÒªÊÇ·¢ËÍµ±Ç°µÄµÆ¹â×´Ì¬£¨´Ó¹ØµÆ×´
             -Ì¬±ä³É°×µÆ£¬Òª·¢ËÍ¸Ã×´Ì¬£©
 531   5      
 532   5                          if (cur_pwm_duty == PWM_MIN_DUTY_LIGHT)
 533   5                          {
 534   6                              // ÏÂ´Î³¤°´Òª±ä³ÉÔö´óÁÁ¶È
 535   6                              light_adjust_add_sub_flag = 1; // ¸üÐÂÓÃÓÚ¿ØÖÆµ÷ÕûµÆ¹âÁÁ¶ÈµÄ±êÖ¾Î»
 536   6                          }
 537   5                          else
 538   5                          {
 539   6                              // ÏÂ´Î³¤°´Òª±ä³É¼õÐ¡ÁÁ¶È
 540   6                              light_adjust_add_sub_flag = 0; // ¸üÐÂÓÃÓÚ¿ØÖÆµ÷ÕûµÆ¹âÁÁ¶ÈµÄ±êÖ¾Î»
 541   6                          }
 542   5                      }
 543   4                      else if (LIGHT_MUILTY_CUR_WHITE == light_muilty_cur_status) // »ÆµÆ£¨´Ó°×µÆ->»ÆµÆ£©
 544   4                      {
C51 COMPILER V9.60.7.0   TK_SET                                                            08/08/2024 17:07:42 PAGE 10  

 545   5                          cur_pwm_duty = cur_yellow_duty;
 546   5      
 547   5                          tmr1_set_pwm_duty(0); // ¹Ø±Õ°×µÆ
 548   5                          white_light_close();  // ÖØÐÂÅäÖÃIOºÍ¶¨Ê±Æ÷
 549   5      
 550   5                          tmr0_set_pwm_duty(cur_pwm_duty); // »ÆµÆ
 551   5                          yellow_light_open();             // ÖØÐÂÅäÖÃIOºÍ¶¨Ê±Æ÷
 552   5      
 553   5                          light_muilty_cur_status = LIGHT_MUILTY_CUR_YELLOW;
 554   5                          light_on_off_status = 1; // ¸üÐÂµÆµÄ×´Ì¬
 555   5                          send_key_status(0x00);   // ·¢ËÍ²»´ø°´¼üÐÅÏ¢µÄÊý¾Ý
 556   5      
 557   5                          if (cur_pwm_duty == PWM_MIN_DUTY_LIGHT)
 558   5                          {
 559   6                              // ÏÂ´Î³¤°´Òª±ä³ÉÔö´óÁÁ¶È
 560   6                              light_adjust_add_sub_flag = 1; // ¸üÐÂÓÃÓÚ¿ØÖÆµ÷ÕûµÆ¹âÁÁ¶ÈµÄ±êÖ¾Î»
 561   6                          }
 562   5                          else
 563   5                          {
 564   6                              // ÏÂ´Î³¤°´Òª±ä³É¼õÐ¡ÁÁ¶È
 565   6                              light_adjust_add_sub_flag = 0; // ¸üÐÂÓÃÓÚ¿ØÖÆµ÷ÕûµÆ¹âÁÁ¶ÈµÄ±êÖ¾Î»
 566   6                          }
 567   5                      }
 568   4                      else if (LIGHT_MUILTY_CUR_YELLOW == light_muilty_cur_status) // »Æ°×µÆ£¬ÐèÒª×¢Òâ×î´óÁÁ¶ÈµÄ
             -Õ¼¿Õ±ÈÎª60%£¨´Ó»ÆµÆ->»Æ°×µÆ£©
 569   4                      {
 570   5                          cur_pwm_duty = cur_yellow_white_duty;
 571   5                          tmr0_set_pwm_duty(cur_pwm_duty);
 572   5                          tmr1_set_pwm_duty(cur_pwm_duty);
 573   5      
 574   5                          white_light_open(); // Ö®Ç°¹Ø±ÕÁË°×µÆ£¬ÏÖÔÚÒªÖØÐÂÅäÖÃIOºÍ¶¨Ê±Æ÷
 575   5      
 576   5                          light_muilty_cur_status = LIGHT_MUILTY_CUR_YELLOW_WHITE;
 577   5                          light_on_off_status = 1; // ¸üÐÂµÆµÄ×´Ì¬
 578   5                          send_key_status(0x00);   // ·¢ËÍ²»´ø°´¼üÐÅÏ¢µÄÊý¾Ý
 579   5      
 580   5                          if (cur_pwm_duty == PWM_MIN_DUTY_LIGHT)
 581   5                          {
 582   6                              // ÏÂ´Î³¤°´Òª±ä³ÉÔö´óÁÁ¶È
 583   6                              light_adjust_add_sub_flag = 1; // ¸üÐÂÓÃÓÚ¿ØÖÆµ÷ÕûµÆ¹âÁÁ¶ÈµÄ±êÖ¾Î»
 584   6                          }
 585   5                          else
 586   5                          {
 587   6                              // ÏÂ´Î³¤°´Òª±ä³É¼õÐ¡ÁÁ¶È
 588   6                              light_adjust_add_sub_flag = 0; // ¸üÐÂÓÃÓÚ¿ØÖÆµ÷ÕûµÆ¹âÁÁ¶ÈµÄ±êÖ¾Î»
 589   6                          }
 590   5                      }
 591   4                      else if (LIGHT_MUILTY_CUR_YELLOW_WHITE == light_muilty_cur_status) // ¹ØµÆ£¨´Ó»Æ°×µÆ->¹ØµÆ
             -£©
 592   4                      {
 593   5                          cur_pwm_duty = 0;
 594   5                          tmr0_set_pwm_duty(cur_pwm_duty);
 595   5                          tmr1_set_pwm_duty(cur_pwm_duty);
 596   5                          white_light_close();
 597   5                          yellow_light_close();
 598   5      
 599   5                          light_muilty_cur_status = LIGHT_MUILTY_CUR_OFF;
 600   5                          light_on_off_status = 0; // ¸üÐÂµÆµÄ×´Ì¬
 601   5                          send_key_status(0x00);   // ·¢ËÍ²»´ø°´¼üÐÅÏ¢µÄÊý¾Ý£¬Ö÷ÒªÊÇ·¢ËÍµ±Ç°µÄµÆ¹â×´Ì¬
 602   5      
 603   5                          // // ÏÂ´Î³¤°´Òª±ä³É¼õÐ¡ÁÁ¶È
 604   5                          // light_adjust_add_sub_flag = 0; // ¸üÐÂÓÃÓÚ¿ØÖÆµ÷ÕûµÆ¹âÁÁ¶ÈµÄ±êÖ¾Î»
C51 COMPILER V9.60.7.0   TK_SET                                                            08/08/2024 17:07:42 PAGE 11  

 605   5                      }
 606   4                  }
 607   3              }
 608   2      #endif
 609   2      
 610   2      #if 0  // ÔÚdemo°åÉÏ½øÐÐ¿ªµÆºÍ¹ØµÆµÄ¹¦ÄÜ²âÊÔ--²âÊÔÍ¨¹ý
                      white_light_close();
                      delay_ms(500);
                      white_light_open();
                      delay_ms(500);
              #endif // ÔÚdemo°åÉÏ½øÐÐ¿ªµÆºÍ¹ØµÆµÄ¹¦ÄÜ²âÊÔ--²âÊÔÍ¨¹ý
 616   2      
 617   2              /* Î¹¹· :½¨Òé²»Òª¹Ø±Õ¿´ÃÅ¹·£¬Ä¬ÈÏ2s¸´Î»*/
 618   2              // WDT_KEY = WDT_KEY_VAL(0xAA);
 619   2          }
 620   1      }
 621          
 622          /*************************** (C) COPYRIGHT 2022 TAIXIN-IC ***** END OF FILE *****/


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =   1274    ----
   CONSTANT SIZE    =     46    ----
   XDATA SIZE       =     72    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =   ----    ----
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
